                                                          -*- rst -*-
          How to add new variants of SgNode to minitermite


Adrian Prantl <adrian@llnl.gov, adrian@complang.tuwien.ac.at>, 2012.


Adding new / unsupported SgNode variants
========================================

rose -> term
------------
1. Add a case to RoseToTerm::getSpecific().
2. Implement RoseToTerm::get##Variant##Specific()
   The following supporting functions/macros are available:
   * preprocessing_info: PPI
   * flags: MAKE_FLAG()
   * enums: enum_atom()
     a specialized version for each enum type is autogenerated at
     compile-time by find-enums.
   * orphaned (ignored by traversal) sub-nodes: traverseSingleNode
   * types: getTypeSpecific()

term -> rose
------------
3. Add a case to [unary|binary|...]ToRose()
4. Implement create##Variant##()
   The following supporting functions/macros are available:
   * EXPECT_NODE, EXPECT_TERM, EXPECT_TERM_NAME,
     EXPECT_TERM_NAME_ARITY, EXPECT_ATOM
   * flags: createFlag()
   * enums: re.enum_##ENUM##[name] 
	 a map<string, enum>) generated by find-enums.
   * orphaned (ignored by traversal) sub-nodes: toRose()
   * types: createType()

termite grammar
---------------
5. Add the node to the formal termite grammar in
   src/termite/termite_spec.pl following the documentation there.

test case
---------
6. Most importantly, create a new test case in the
   projects/minitermite/regression directory. 
7. Execute
   >>> src2term <yourtest> -o yourtest.term
   >>> term2src yourtest.term
   and verify that the output file <yourtest>.unparsed.<ext>
   resembles the original input.
8. Add the test file to the TERMITE_[FORTRAN_]TESTS variable in 
   projects/minitermite/regression/make_rule.inc
9. Make sure that 'make check -C projects/minitermite' succeeds for a
   ROSE configured using the --with-swi-prolog=yes option!
   
It doesn't work! Help?
----------------------

If the node type involves anything symbol-table-related, there is a
good chance that merely creating the node is not sufficient. There are
a couple of ad-hoc symbol tables and fixups in TermToRose to deal with
this.

Some are:
* Scopes: DeclarationStatements need to have a scope. Simply add it to
  declarationStatementsWithoutScope.

See also: AstJanitor.h ; TermToRose.h

If all else fails send me an email.
